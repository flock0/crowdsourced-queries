  <html>
     <head>
       <style>
         header {
                 background-color:black;
                 color:white;
                 text-align:center;
                 padding:5px;
        }
         nav {
             line-height:30px;
             background-color:#eeeeee;
             height:400px;
             width:600px;
             float:left;
             padding:10px;
        }
         section {
                  width:600px;
                  float:right;
                  padding:10px;
        }

       </style>
      </head>

    <body>
      <header>
          <h1>Generate your own query</h1>
      </header>
      <script type="text/javascript"
              src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script type="text/javascript" language="javascript">
      var i=0;

      $(document).ready(function() {
         $.getJSON('/query/all', function(jd) {
            var $tbody = $("#usertable tbody");
            $tbody.html("");
            var tabledata = "";
            for(i = 0; i < jd.list_of_queries.length; i++ ){
               var timestamp = jd.list_of_queries[i].start_time;
               var theDate = new Date(timestamp);
               datevalues = theDate.toGMTString();
               var timestamp2=jd.list_of_queries[i].end_time;
               var theDate2=new Date(timestamp2);
               dataends=theDate2.toGMTString();
              tabledata = "";
              tabledata += "<tr>";
              tabledata += "<td>" +jd.list_of_queries[i].query_id + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].query_status + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].query_results_number + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].detaied_query_results + "</td>";
              tabledata += "<td>" +datevalues+ "</td>";
              tabledata += "<td>" +dataends+ "</td>";
              tabledata += "<td>" + '<input type="button" value="details" onclick= "display(this)" name=" '+jd.list_of_queries[i].query_id+' " />'+ '<input type="button" value="abort" onclick= "abort(this)" name=" '+jd.list_of_queries[i].query_id+' " />'+
                "</td>";
              tabledata += "</tr>";
              tabledata += "<tr>";
              tabledata += "<td colspan=7>" +jd.list_of_queries[i].query_string + "</td>";
              tabledata += "</tr>"; 
              $tbody.append(tabledata);
            }
          });
        $("#question_form").on('submit', function(event){
          $.post( "/query/new", { question: $("#question_input").val()} );
           $.getJSON('/query/all', function(jd) {
            var $tbody = $("#usertable tbody");
            $tbody.html("");
            var tabledata = "";
            for(i = 0; i < jd.list_of_queries.length; i++ ){
              var timestamp = jd.list_of_queries[i].start_time;
              var theDate = new Date(timestamp);
              dateString = theDate.toGMTString();
              tabledata = "";
              tabledata += "<tr>";
              tabledata += "<td>" +jd.list_of_queries[i].query_id + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].query_status + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].query_results_number + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].detaied_query_results + "</td>";
             
              tabledata += "<td>" +datevalues+ "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].end_time + "</td>";
              tabledata += "<td>" + '<input type="button" value="details" onclick= "display(this)" name=" '+jd.list_of_queries[i].query_id+' " />'+ '<input type="button" value="abort" onclick= "abort(this)" name=" '+jd.list_of_queries[i].query_id+' " />'+
                "</td>";

              tabledata += "</tr>";
              tabledata += "<tr>";
              tabledata += "<td colspan=7>" + jd.list_of_queries[i].query_string  +"</td>";
              tabledata += "</tr>"; 
              $tbody.append(tabledata);

            }
         });
        });
      });
   
      function display(value) {
        $.getJSON('/query/all', function(jd) {
          var $tdetail = $("#detail tbody");
          $tdetail.html("");
          var tabledetail = "";
          for(i = 0; i < jd.list_of_queries[value.name-0].list_of_tasks.length; i++ ){
            tabledetail = "";
            tabledetail += "<tr>";
            tabledetail += "<td>" + jd.list_of_queries[value.name-0].list_of_tasks[i].task_id + "</td>";
            tabledetail += "<td>" + jd.list_of_queries[value.name-0].list_of_tasks[i].task_status + "</td>";
            tabledetail += "<td>" + jd.list_of_queries[value.name-0].list_of_tasks[i].task_operator + "</td>";
            tabledetail += "<td>" + jd.list_of_queries[value.name-0].list_of_tasks[i].number_of_hits + "</td>";
            tabledetail += "<td>" + jd.list_of_queries[value.name-0].list_of_tasks[i].finished_hits + "</td>";
            tabledetail += "<td>" + jd.list_of_queries[value.name-0].list_of_tasks[i].task_results_number + "</td>";
           
            tabledetail +="</tr>";
            $tdetail.append(tabledetail);
          }
        });
      }

        function abort(value){
        $.getJSON('/query/all', function(jd) {
          var $tthead=$("#usertable thead");
          var $tbody = $("#usertable tbody");
          $tbody.html(" ");
          var tabledata = " ";
          for(i = 0; i < jd.list_of_queries.length; i++){
            if(i!=value.name){
              tabledata = " ";
              tabledata += "<tr>";
              tabledata += "<td>" + jd.list_of_queries[i].query_id + "</td>";
              tabledata += "<td>" + jd.list_of_queries[i].query_status + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].query_results_number + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].detailed_query_results + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].start_time + "</td>";
              tabledata += "<td>" +jd.list_of_queries[i].end_time+ "</td>";
              tabledata += "<td>" + '<input type="button" value="details" onclick= "display(this)" name=" '+jd.list_of_queries[i].query_id+' " />'+ '<input type="button" value="abort" onclick= "abort(this)" name=" '+jd.list_of_queries[i].query_id+' " />'+
                "</td>";
              tabledata += "</tr>";
               tabledata += "<tr>";
              tabledata += "<td colspan=7>" +jd.list_of_queries[i].query_string + "</td>";
              tabledata += "</tr>"; 
              $tbody.append(tabledata);
            }

          }
        });
      }

      </script>
      </head>

     <section>
       <form id="question_form">
         <div id="stage1" >
             Please enter your query <input id="question_input" type="text" name="question" size="50" />
         </div>
         <div id="stage"> </div>
         <br />
         <input type="submit" id="driver" value="submit query" />
       </form>

        <br />
        <br />
          <table id="usertable" border="1" cellpadding="5" cellspacing=0>
            <thead>
             <tr>
               <th>query id</th>
               <th>query status</th>
               <th>query result_number</th>
               <th>query results</th>
               <th>start time</th>
               <th> end time </th>
               <th>action</th>
             </tr>
            </thead>
            <tbody> </tbody>
         </table>
        <br />

        <form>
           <input type="submit" id="submit" value="go back"formaction="/queryexample.html"  >
        </form>
      </section>

      <nav>
         <table id="detail" border="1" cellpadding="5" cellspacing=0>
          <thead>
             <tr>
               <th>task id</th>
               <th>task status</th>
               <th>task operator</th>
               <th>number of hits</th>
               <th>finished hits </th>
               <th>task result number</th>
             </tr>
            </thead>

           <tbody> </tbody>
         </table>
         <br />
      </nav>
     </body>
  </html>
